<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Dashboard de Procesos - Torre de Control</title>
  
  <link rel="icon" href="icons/favicon.ico"/>
  
  <!-- LibrerÃ­as -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  
  <link rel="stylesheet" href="flow-styles.css?v=1.0"/>
  <link rel="manifest" href="manifest.json"/>
</head>
<body>
  <header class="app-header">
    <div class="brand">
      <img src="assets/logo.png" alt="logo" width="40" height="40"/>
      <div>
        <h1>Dashboard de Procesos F8</h1>
        <small>Seguimiento de Flujo de Pedidos - v2.0 - Torre de Control</small>
      </div>
    </div>
    <div class="header-actions">
      <a href="index.html" class="btn-link">Vista ClÃ¡sica</a>
      <button id="btnLogin">Acceder</button>
      <button id="btnEditMode" disabled>Modo ediciÃ³n: OFF</button>
      <button id="btnRefresh">Actualizar</button>
    </div>
  </header>

  <!-- Bloques del Flujo de Proceso -->
  <section id="process-flow">
    <div class="flow-block" data-stage="RECIBO" data-days="0">
      <div class="flow-block-header">RECIBO F8</div>
      <div class="flow-block-count" id="count-recibo">0</div>
      <div class="flow-block-label">Pedidos</div>
      <div class="flow-block-days">DÃ­a 0</div>
    </div>
    <div class="flow-arrow">â†’</div>
    <div class="flow-block" data-stage="ASIGNACION" data-days="1">
      <div class="flow-block-header">ASIGNACIÃ“N</div>
      <div class="flow-block-count" id="count-asignacion">0</div>
      <div class="flow-block-label">Pedidos</div>
      <div class="flow-block-days">+1 dÃ­a</div>
    </div>
    <div class="flow-arrow">â†’</div>
    <div class="flow-block" data-stage="SALIDA" data-days="2">
      <div class="flow-block-header">SALIDA</div>
      <div class="flow-block-count" id="count-salida">0</div>
      <div class="flow-block-label">Pedidos</div>
      <div class="flow-block-days">+1 dÃ­a</div>
    </div>
    <div class="flow-arrow">â†’</div>
    <div class="flow-block" data-stage="DESPACHO" data-days="3">
      <div class="flow-block-header">DESPACHO</div>
      <div class="flow-block-count" id="count-despacho">0</div>
      <div class="flow-block-label">Pedidos</div>
      <div class="flow-block-days">+1 dÃ­a</div>
    </div>
    <div class="flow-arrow">â†’</div>
    <div class="flow-block" data-stage="FACTURACION" data-days="4">
      <div class="flow-block-header">FACTURACIÃ“N</div>
      <div class="flow-block-count" id="count-facturacion">0</div>
      <div class="flow-block-label">Pedidos</div>
      <div class="flow-block-days">+1 dÃ­a</div>
    </div>
    <div class="flow-arrow">â†’</div>
    <div class="flow-block" data-stage="EMPACADO" data-days="5">
      <div class="flow-block-header">EMPACADO</div>
      <div class="flow-block-count" id="count-empacado">0</div>
      <div class="flow-block-label">Pedidos</div>
      <div class="flow-block-days">+3 dÃ­as</div>
    </div>
    <div class="flow-arrow">â†’</div>
    <div class="flow-block" data-stage="ENTREGA" data-days="9">
      <div class="flow-block-header">PROY. ENTREGA</div>
      <div class="flow-block-count" id="count-entrega">0</div>
      <div class="flow-block-label">Pedidos</div>
      <div class="flow-block-days">+1 dÃ­a</div>
    </div>
  </section>

  <!-- Resumen RÃ¡pido -->
  <section id="quick-stats">
    <div class="stat-card">
      <div class="stat-label">Total Pedidos</div>
      <div class="stat-value" id="stat-total">0</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">En Proceso</div>
      <div class="stat-value" id="stat-proceso">0</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Completados</div>
      <div class="stat-value" id="stat-completados">0</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Con Retraso</div>
      <div class="stat-value stat-danger" id="stat-retraso">0</div>
    </div>
  </section>

  <!-- Contenedor principal de dos columnas -->
  <div class="main-container">
    <!-- Columna izquierda: Lista de pedidos filtrados -->
    <section class="left-panel">
      <div class="panel-header">
        <h2 id="panel-title">Todos los pedidos</h2>
        <div class="panel-actions">
          <button id="btnClearFilter" style="display:none;">Limpiar filtro</button>
          <button id="btnExport" title="Exportar datos">ðŸ“Š Exportar</button>
        </div>
      </div>
      <div class="orders-list" id="ordersList">
        <p class="loading-message">Cargando pedidos...</p>
      </div>
    </section>

    <!-- Columna derecha: Calendario y anÃ¡lisis -->
    <section class="right-panel">
      <!-- Calendario interactivo -->
      <div class="calendar-container">
        <div class="calendar-header">
          <button id="btnPrevMonth">â—€</button>
          <h3 id="calendarTitle">Calendario</h3>
          <button id="btnNextMonth">â–¶</button>
        </div>
        <div id="calendar" class="calendar-grid">
          <!-- Se generarÃ¡ dinÃ¡micamente -->
        </div>
        <div class="calendar-legend">
          <div class="legend-item">
            <span class="legend-color" style="background:#ef4444"></span>
            <span>Vencido</span>
          </div>
          <div class="legend-item">
            <span class="legend-color" style="background:#f59e0b"></span>
            <span>Hoy</span>
          </div>
          <div class="legend-item">
            <span class="legend-color" style="background:#3b82f6"></span>
            <span>Programado</span>
          </div>
        </div>
      </div>

      <!-- AnÃ¡lisis de Gaps -->
      <div class="gap-analysis-container">
        <h3>AnÃ¡lisis de Deltas (TeÃ³rico vs Real)</h3>
        <canvas id="gapChart"></canvas>
      </div>

      <!-- KPIs de tiempos -->
      <div class="time-kpis">
        <div class="time-kpi">
          <div class="kpi-label">Tiempo promedio teÃ³rico</div>
          <div class="kpi-value" id="kpi-teorico">â€”</div>
        </div>
        <div class="time-kpi">
          <div class="kpi-label">Tiempo promedio real</div>
          <div class="kpi-value" id="kpi-real">â€”</div>
        </div>
        <div class="time-kpi">
          <div class="kpi-label">Delta promedio</div>
          <div class="kpi-value" id="kpi-delta">â€”</div>
        </div>
        <div class="time-kpi">
          <div class="kpi-label">Delta acumulado</div>
          <div class="kpi-value" id="kpi-acumulado">â€”</div>
        </div>
      </div>

      <!-- DistribuciÃ³n de Deltas por Etapa -->
      <div class="stage-deltas-container">
        <h3>Deltas por Etapa del Proceso</h3>
        <canvas id="stageDeltas"></canvas>
      </div>
    </section>
  </div>

  <!-- Endpoints / credenciales -->
  <script>
    window.APP = {
      A_URL: 'https://script.google.com/macros/s/AKfycbxMr-fkiplPoBPm_x6V9ZnEMB9-Kd6ZH1tvKG2t8zIcFNYF8t-gF1JP2d6bRo9BGHgFTA/exec',
      B_URL: 'https://script.google.com/macros/s/AKfycbysdeYW1g-l1p6ZOyk9aPaUIdx5H4GbzYFVeD1T8_SsyQoODqo-dSzjQMeu7lZzYmQ/exec',
      CLIENT_ID: '63868073848-8bfis5g0f8mt14oia3flmbqksg69tejq.apps.googleusercontent.com'
    };
  </script>

  <!-- App -->
  <script src="flow-app.js?v=1.0"></script>
</body>
</html>
