<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Dashboard Pedidos F8</title>

  <link rel="icon" href="icons/favicon.ico">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0b3d91">

  <!-- ðŸ”§ Kill SW + caches de versiones viejas (forzado) -->
  <script>
    (function(){
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations()
          .then(rs => rs.forEach(r => r.unregister()))
          .catch(()=>{});
      }
      if (window.caches) {
        caches.keys().then(keys => keys.forEach(k => caches.delete(k))).catch(()=>{});
      }
    })();
  </script>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <!-- ðŸ”§ cache-bust -->
  <link rel="stylesheet" href="styles.css?v=2025-11-30c"/>
</head>
<body>

<header class="app-header">
  <div class="brand">
    <img src="assets/logo.png" alt="Logo" class="logo">
    <div class="titles">
      <h1 class="title">Dashboard de Pedidos</h1>
      <span class="subtitle">Seguimiento F8</span>
    </div>
  </div>
  <div class="actions">
    <button id="btnLogin" class="btn">Acceder</button>
    <button id="btnEditMode" class="btn" disabled>Modo ediciÃ³n: OFF</button>
    <button id="btnRefresh" class="btn">Actualizar</button>
    <a id="btnEditar" class="btn btn-link" target="_blank" rel="noopener" href="edit.html">Editor clÃ¡sico</a>
  </div>
</header>

<section id="kpis-compact" class="kpis">
  <div class="kpi"><div>Total</div><strong id="kpi-total">â€”</strong></div>
  <div class="kpi"><div>Asignado</div><strong id="kpi-asignado">â€”</strong></div>
  <div class="kpi"><div>Solicitado</div><strong id="kpi-solicitado">â€”</strong></div>
  <div class="kpi"><div>Reng. Asig.</div><strong id="kpi-reng-asig">â€”</strong></div>
  <div class="kpi"><div>Reng. Sol.</div><strong id="kpi-reng-sol">â€”</strong></div>
  <div class="kpi"><div>Urg/Mens</div><strong><span id="kpi-urg">â€”</span>/<span id="kpi-men">â€”</span></strong></div>
</section>

<section class="filters" id="filters">
  <label class="f"><span>CategorÃ­a</span>
    <select id="fCat"><option value="">Todas</option></select>
  </label>
  <label class="f"><span>Unidad</span>
    <select id="fUnidad"><option value="">Todas</option></select>
  </label>
  <label class="f"><span>Tipo</span>
    <select id="fTipo"><option value="">Todos</option></select>
  </label>
  <label class="f"><span>Grupo</span>
    <select id="fGrupo"><option value="">Todos</option></select>
  </label>
  <label class="f"><span>Estado</span>
    <select id="fEstado"><option value="">Todos</option></select>
  </label>
  <label class="f f2"><span>Buscar</span>
    <input id="fBuscar" placeholder="F8 SALMI / textoâ€¦">
  </label>
  <label class="f"><span>Desde</span>
    <input id="fDesde" type="date" title="Desde">
  </label>
  <label class="f"><span>Hasta</span>
    <input id="fHasta" type="date" title="Hasta">
  </label>
  <button id="btnApply">Aplicar</button>
  <button id="btnClear">Limpiar</button>
</section>

<section class="charts">
  <div class="chart chart-line"><canvas id="chart-evol"></canvas></div>
  <div class="chart chart-donut"><canvas id="chart-estado-pastel"></canvas></div>
  <div class="chart chart-bars"><canvas id="chart-estado-grupo"></canvas></div>
</section>

<section class="table-wrap">
  <div id="kpis"></div>
  <div id="top-scroll" class="hscroll"></div>
  <table id="tabla"><thead></thead><tbody></tbody></table>
  <div id="paginacion"></div>
</section>

<script>
  window.APP = {
    A_URL: 'https://script.google.com/macros/s/AKfycbx7-NfduLrSsQhcLkXcx4h_IEaxcOj8cLHdPqzJm8bQEWTTfkKcYCfU-imapmHVxtqysg/exec',
    B_URL: 'https://script.google.com/macros/s/AKfycbysdeYW1g-l1p6ZOyk9aPaUIdx5H4GbzYFVeD1T8_SsyQoODqo-dSzjQMeu7lZzYmQ/exec',
    CLIENT_ID: '63868073848-8bfis5g0f8mt14oia3flmbqksg69tejq.apps.googleusercontent.com'
  };
</script>

<!-- ðŸ”§ cache-bust -->
<script src="metrics.js?v=2025-11-30c"></script>
<script src="app.js?v=2025-11-30c"></script>

<!-- SW: limpieza + unregister (igual que antes, con nueva versiÃ³n para bustear) -->
<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js?v=2025-11-30c', { scope: '/Dashboard_Pedidos_F8/' }).catch(console.error);
  }
</script>
</body>
</html>
