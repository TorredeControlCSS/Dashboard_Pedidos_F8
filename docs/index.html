<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Dashboard de Pedidos</title>

  <!-- (Cámbialo si tu favicon tiene otro nombre/ruta) -->
  <link rel="icon" href="icons/favicon.ico"/>

  <!-- Librerías -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <link rel="stylesheet" href="styles.css?v=2025-12-01a"/>
  <link rel="manifest" href="manifest.json"/>
</head>
<body>
  <header class="app-header">
    <div class="brand">
      <!-- (Cámbialo si tu logo tiene otro nombre/ruta) -->
      <img src="assets/logo.png" alt="logo" width="40" height="40"/>
      <div>
        <h1>Dashboard de Pedidos</h1>
        <small>Seguimiento F8</small>
      </div>
    </div>
    <div class="header-actions">
      <button id="btnLogin">Acceder</button>
      <button id="btnEditMode" disabled>Modo edición: OFF</button>
      <button id="btnRefresh">Actualizar</button>
      <a id="btnClassic" href="edit.html" target="_blank" rel="noopener">Editor clásico</a>
    </div>
  </header>

  <!-- KPIs -->
  <section id="kpis">
    <div class="kpi"><div>Total</div><strong id="kpi-total">—</strong></div>
    <div class="kpi"><div>Asignado</div><strong id="kpi-asignado">—</strong></div>
    <div class="kpi"><div>Solicitado</div><strong id="kpi-solicitado">—</strong></div>
    <div class="kpi"><div>Reng. Asig.</div><strong id="kpi-reng-asig">—</strong></div>
    <div class="kpi"><div>Reng. Sol.</div><strong id="kpi-reng-sol">—</strong></div>
    <div class="kpi"><div>Urg/Mens</div><strong><span id="kpi-urg">0</span>/<span id="kpi-men">—</span></strong></div>

    <!-- KPIs de tiempos (RECIBO F8 vs PROMESA vs REAL) -->
    <div class="kpi"><div>Promedio días REAL</div><strong id="kpi-t-real">—</strong></div>
    <div class="kpi"><div>Promedio días PROMESA</div><strong id="kpi-t-prom">—</strong></div>
    <div class="kpi"><div>Diferencia (Real − Prom)</div><strong id="kpi-t-diff">—</strong></div>
    
  </section>

<!-- Filtros -->
<section id="filters">
  <div class="row">
    <label for="fCat">Categoría</label>
    <select id="fCat">
      <option value="">Todas</option>
    </select>

    <label for="fUnidad">Unidad</label>
    <select id="fUnidad">
      <option value="">Todas</option>
    </select>

    <label for="fTipo">Tipo</label>
    <select id="fTipo">
      <option value="">Todos</option>
    </select>

    <label for="fGrupo">Grupo</label>
    <select id="fGrupo">
      <option value="">Todos</option>
    </select>

    <label for="fEstado">Estado</label>
    <select id="fEstado">
      <option value="">Todos</option>
    </select>

    <label for="fComent">Comentario</label>
    <select id="fComent">
      <option value="">Todos</option>
      <option value="DISCREPANCIA DE INVENTARIO">DISCREPANCIA DE INVENTARIO</option>
      <option value="FALTA DE PERSONAL">FALTA DE PERSONAL</option>
      <option value="VIATICOS PARA VIAJES">VIATICOS PARA VIAJES</option>
      <option value="FALTA MONTACARGA">FALTA MONTACARGA</option>
      <option value="CONGESTIONAMIENTO EN SALIDAS">CONGESTIONAMIENTO EN SALIDAS</option>
      <option value="FACTURACION RETRASADA">FACTURACION RETRASADA</option>
      <option value="FALLAS EN SISTEMA">FALLAS EN SISTEMA</option>
    </select>

    <label for="fBuscar">Buscar</label>
    <input id="fBuscar" placeholder="F8 SALMI / texto…"/>

    <label for="fDesde">Desde</label>
    <input id="fDesde" type="date"/>

    <label for="fHasta">Hasta</label>
    <input id="fHasta" type="date"/>

    <button id="btnApply">Aplicar</button>
    <button id="btnClear">Limpiar</button>
  </div>
</section>
  
  <!-- Gráficos -->
  <section id="charts">
    <div class="card">
      <h3>Evolución de Pedidos</h3>
      <canvas id="ch-evol"></canvas>
    </div>
    <div class="card">
      <h3>Distribución por Estados</h3>
      <canvas id="ch-donut"></canvas>
    </div>
    <div class="card">
      <h3>Estado de Avance por Grupo (% de pedidos)</h3>
      <canvas id="ch-grupos"></canvas>
    </div>
  </section>

    <section id="queues" class="table-wrap" style="margin-top:16px;">
    <h3>Análisis de Congestionamiento por Grupo (M/M/s)</h3>
    <table id="tabla-queues">
      <thead></thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Scroll superior sincronizado -->
  <div id="top-scroll"></div>

  <!-- Tabla -->
  <section class="table-wrap">
    <table id="tabla">
      <thead></thead>
      <tbody></tbody>
    </table>
  </section>
  <div id="paginacion" class="pager"></div>

  <!-- Endpoints / credenciales -->
  <script>
    window.APP = {
      // Script A (lectura / stats). Probado con echo y stats.
      A_URL: 'https://script.google.com/macros/s/AKfycbyiD8mYaXXgtgz_DAE0A9IFx6po4CWlRUCce8EjoMA36jmdYOpavcJmncJP5r1k0AcQNg/exec',
      // Script B (escritura / update). Tu script B operativo.
      B_URL: 'https://script.google.com/macros/s/AKfycbysdeYW1g-l1p6ZOyk9aPaUIdx5H4GbzYFVeD1T8_SsyQoODqo-dSzjQMeu7lZzYmQ/exec',
      CLIENT_ID: '63868073848-8bfis5g0f8mt14oia3flmbqksg69tejq.apps.googleusercontent.com'
    };
  </script>

  <!-- App -->
  <script src="metrics.js?v=2025-12-01a"></script>
  <!-- Parche de stats desactivado -->
  <!-- <script src="app_fetchstats_patch.js?v=2025-12-01a"></script> -->
  <!-- Parche de filtros desactivado -->
  <!-- <script src="app_filters_patch.js?v=2025-12-01a"></script> -->
  <script src="app.js?v=2025-12-01a"></script>
</body>
</html>
