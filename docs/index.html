<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Dashboard de Requisiciones</title>

  <!-- (CÃ¡mbialo si tu favicon tiene otro nombre/ruta) -->
  <link rel="icon" href="icons/favicon.ico"/>

  <!-- LibrerÃ­as -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <link rel="stylesheet" href="styles.css?v=2025-12-01b"/>
  <link rel="manifest" href="manifest.json"/>
</head>
<body>
  <header class="app-header">
    <div class="brand">
      <!-- (CÃ¡mbialo si tu logo tiene otro nombre/ruta) -->
      <img src="assets/logo.png" alt="logo" width="40" height="40"/>
      <div>
        <h1>Dashboard de Requisiciones</h1>
        <small>Seguimiento de F8 - v1.0 - Torre de Control</small>
      </div>
    </div>
    <div class="header-actions">
      <button id="btnLogin">Acceder</button>
      <button id="btnEditMode" disabled>Modo ediciÃ³n: OFF</button>
      <button id="btnRefresh">Actualizar</button>
      <!-- <a id="btnClassic" href="edit.html" target="_blank" rel="noopener">Editor clÃ¡sico</a> -->
    </div>
  </header>

  <!-- KPIs -->
  <section id="kpis">
    <div class="kpi"><div>Total</div><strong id="kpi-total">â€”</strong></div>
    <div class="kpi"><div>Asignado</div><strong id="kpi-asignado">â€”</strong></div>
    <div class="kpi"><div>Solicitado</div><strong id="kpi-solicitado">â€”</strong></div>
    <div class="kpi"><div>Reng. Asig.</div><strong id="kpi-reng-asig">â€”</strong></div>
    <div class="kpi"><div>Reng. Sol.</div><strong id="kpi-reng-sol">â€”</strong></div>
    <div class="kpi"><div>Urg/Mens</div><strong><span id="kpi-urg">0</span>/<span id="kpi-men">â€”</span></strong></div>

    <!-- KPIs de tiempos (RECIBO F8 vs PROMESA vs REAL) -->
    <div class="kpi"><div>Promedio dÃ­as REAL</div><strong id="kpi-t-real">â€”</strong></div>
    <div class="kpi"><div>Promedio dÃ­as PROMESA</div><strong id="kpi-t-prom">â€”</strong></div>
    <div class="kpi"><div>Diferencia (Real âˆ’ Prom)</div><strong id="kpi-t-diff">â€”</strong></div>
  </section>

  <!-- Filtros -->
  <section id="filters">
    <div class="row">
      <select id="fCat">
        <option value="">Todas las categorÃ­as</option>
      </select>

      <select id="fUnidad">
        <option value="">Todas las unidades</option>
      </select>

      <select id="fTipo">
        <option value="">Todos los tipos</option>
      </select>

      <select id="fGrupo">
        <option value="">Todos los grupos</option>
      </select>

      <select id="fEstado">
        <option value="">Todos los estados</option>
      </select>

      <select id="fComent">
        <option value="">Todos los comentarios</option>
        <option value="DISCREPANCIA DE INVENTARIO">DISCREPANCIA DE INVENTARIO</option>
        <option value="FALTA DE PERSONAL">FALTA DE PERSONAL</option>
        <option value="VIATICOS PARA VIAJES">VIATICOS PARA VIAJES</option>
        <option value="FALTA MONTACARGA">FALTA MONTACARGA</option>
        <option value="CONGESTIONAMIENTO EN SALIDAS">CONGESTIONAMIENTO EN SALIDAS</option>
        <option value="FACTURACION RETRASADA">FACTURACION RETRASADA</option>
        <option value="FALLAS EN SISTEMA">FALLAS EN SISTEMA</option>
        <option value="DEMORA EN DOCUMENTACION">DEMORA EN DOCUMENTACION</option>
        <option value="ERROR DE CAPTACION">ERROR DE CAPTACION</option>
        <option value="ENTREGADO">ENTREGADO</option>
      </select>

      <input id="fBuscar" placeholder="ðŸ”Ž Buscar F8 SALMI / textoâ€¦"/>

      <input id="fDesde" type="date" placeholder="Desde"/>
      <span class="filter-sep">a</span>
      <input id="fHasta" type="date" placeholder="Hasta"/>

      <button id="btnApply">Aplicar filtros</button>
      <button id="btnClear">Limpiar</button>
    </div>
  </section>
  
  <!-- Bloque Ãºnico de grÃ¡ficos + anÃ¡lisis -->
  <section id="charts">
    <!-- Fila 1: EvoluciÃ³n ancho completo -->
    <div class="charts-row-top">
      <div class="card card-evol">
        <h3>EvoluciÃ³n de Pedidos</h3>
        <canvas id="ch-evol"></canvas>
      </div>
    </div>

    <!-- Fila 2: 3 columnas -->
    <div class="charts-row-bottom">
      <div class="card card-coment">
        <h3>Comentarios (conteo de pedidos)</h3>
        <canvas id="ch-donut"></canvas>
      </div>

      <div class="card card-grupos">
        <h3>Estado de Avance por Grupo (% de pedidos)</h3>
        <canvas id="ch-grupos"></canvas>
      </div>

      <div class="card card-queues">
        <h3>AnÃ¡lisis de Congestionamiento por Grupo (M/M/s)</h3>
        <div class="queue-table-wrap">
          <table id="tabla-queues">
            <thead></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>
  </section>

  <!-- Scroll superior sincronizado -->
  <div id="top-scroll"></div>

  <!-- Tabla principal -->
  <section class="table-wrap">
    <table id="tabla">
      <thead></thead>
      <tbody></tbody>
    </table>
  </section>
  <div id="paginacion" class="pager"></div>

  <!-- Endpoints / credenciales -->
  <script>
    window.APP = {
      // Script A (lectura / stats). Probado con echo y stats.
      A_URL: 'https://script.google.com/macros/s/AKfycbyNEa3cJzX70g2vQrYhZLP-QcsqGvu_d2R_9t5zKuYDO7jQ2QxF2RAetLOOo9TUw_e58A/exec',
      // Script B (escritura / update). Tu script B operativo.
      B_URL: 'https://script.google.com/macros/s/AKfycbysdeYW1g-l1p6ZOyk9aPaUIdx5H4GbzYFVeD1T8_SsyQoODqo-dSzjQMeu7lZzYmQ/exec',
      CLIENT_ID: '63868073848-8bfis5g0f8mt14oia3flmbqksg69tejq.apps.googleusercontent.com'
    };
  </script>

  <!-- App -->
  <script src="metrics.js?v=2025-12-01a"></script>
  <script src="app.js?v=2025-12-01b"></script>
</body>
</html>
